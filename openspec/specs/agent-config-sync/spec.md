# Agent Config Sync

## Purpose

Define how wai manages AI agent configurations as a single source of truth, with projections to tool-specific formats like `.claude/`, `.cursorrules`, `.windsurfrules`, and `AGENTS.md`.

## Problem Statement

Modern development involves multiple AI coding assistants (Claude Code, Cursor, Windsurf, etc.), each requiring its own configuration format and location. Maintaining consistent agent instructions across these tools leads to configuration drift, duplicated effort, and inconsistent behavior. Developers need a single source of truth for agent configurations that can be projected to each tool's expected format automatically.

## Design Rationale

### Single Source of Truth

Storing all agent configuration in `.wai/resources/agent-config/` is a **Type 1 decision**. This centralizes skills, rules, and context files in one location, making them versionable, reviewable, and consistent. Tool-specific files become projections of this canonical source rather than independent configurations.

### Projection Strategies

Three projection strategies (symlink, inline, reference) provide flexibility for different tool requirements. This is a **Type 2 decision** — the strategies may evolve, but the concept of projecting from a single source is foundational.

- **Symlink**: Creates filesystem symlinks from tool locations to the canonical files. Most efficient, but requires symlink support.
- **Inline**: Concatenates source files into a single output file with auto-generated headers. Works everywhere, but requires re-running sync after changes.
- **Reference**: Generates an index file pointing to `.wai/` locations. Lightweight, but requires tool support for following references.

### Auto-Generated Headers

Projected files include `# Auto-generated by wai — do not edit directly` headers to prevent accidental direct edits and make the generation pipeline visible.

## Scope and Requirements

This spec covers the storage, organization, and projection of agent configuration files.

### Non-Goals

- Defining the content or semantics of agent rules/skills
- Managing tool-specific settings beyond agent instructions (e.g., Cursor's editor settings)
- Automatic detection and sync on file change (manual `wai sync` is required)
- Remote or team-wide config sharing

### Requirement: Agent Config Storage

Agent configurations SHALL be stored in a structured directory within `.wai/resources/`.

#### Scenario: Config directory structure

- **WHEN** wai is initialized
- **THEN** the agent-config directory structure is:
  ```
  .wai/resources/agent-config/
  ├── skills/       # Reusable agent capabilities
  ├── rules/        # Behavioral guidelines
  ├── context/      # Project-specific context
  └── .projections.yml
  ```

### Requirement: Projections Configuration

A `.projections.yml` file SHALL define how configs are projected to tool-specific locations.

#### Scenario: Projections file format

- **WHEN** configuring projections
- **THEN** `.projections.yml` follows this format:
  ```yaml
  projections:
    - target: .claude/
      strategy: symlink
      sources:
        - skills/
        - rules/
    - target: .cursorrules
      strategy: inline
      sources:
        - rules/
        - context/
    - target: AGENTS.md
      strategy: inline
      sources:
        - context/
  ```

### Requirement: Sync Command

The CLI SHALL provide a `wai sync` command to execute projections.

#### Scenario: Execute projections

- **WHEN** user runs `wai sync`
- **THEN** the system reads `.projections.yml`
- **AND** generates projected files according to each target's strategy
- **AND** reports which files were created or updated

#### Scenario: Check sync status

- **WHEN** user runs `wai sync --status`
- **THEN** the system shows which projections are up-to-date and which need syncing
- **AND** does not modify any files

### Requirement: Config Management

The CLI SHALL support managing agent config files.

#### Scenario: Add a skill

- **WHEN** user runs `wai config add skill <file>`
- **THEN** the system copies the file to `.wai/resources/agent-config/skills/`

#### Scenario: Add a rule

- **WHEN** user runs `wai config add rule <file>`
- **THEN** the system copies the file to `.wai/resources/agent-config/rules/`

#### Scenario: List configs

- **WHEN** user runs `wai config list`
- **THEN** the system shows all files in skills/, rules/, and context/ directories

### Requirement: Import Existing Configs

The CLI SHALL support importing configurations from existing tool-specific files.

#### Scenario: Import from Claude directory

- **WHEN** user runs `wai import .claude/`
- **THEN** the system detects Claude-specific config files
- **AND** copies them into the appropriate agent-config subdirectories

#### Scenario: Import from cursorrules

- **WHEN** user runs `wai import .cursorrules`
- **THEN** the system reads the cursorrules file
- **AND** imports the content as agent rules

### Requirement: Auto-Generated Headers

Projected files SHALL include headers indicating they are auto-generated.

#### Scenario: Generated file header

- **WHEN** a file is generated via `wai sync`
- **THEN** it begins with a comment: `# Auto-generated by wai — do not edit directly`
- **AND** includes the source path for reference
