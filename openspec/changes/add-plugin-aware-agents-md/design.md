## Context

Wai's managed block injection (`<!-- WAI:START -->` to `<!-- WAI:END -->`) is currently a static string generated by `managed_block::wai_block_content()`. The `init` command auto-detects plugins (beads, openspec, git) but this information is only used for `PLUGINS.md` generation — never passed to the managed block. Three tools (wai, beads, openspec) each inject their own instruction blocks into AGENTS.md independently, with no cross-tool guidance.

## Goals / Non-Goals

**Goals:**
- Make the managed block content conditional on detected plugins
- Provide agents a single coherent "tool landscape" view
- Define clear tool boundaries: wai = reasoning/why, beads = tasks/what, openspec = specs/requirements
- Unified session start/end flow that acknowledges all detected tools
- Keep the marker-based injection protocol unchanged

**Non-Goals:**
- Modifying openspec's or beads' own managed blocks / instruction files
- Making wai responsible for generating beads or openspec instructions
- Adding new CLI commands or flags
- Changing the plugin detection mechanism itself

## Decisions

**Decision: Conditional string building in `wai_block_content()`**
- The function gains a `detected_plugins: &[&str]` parameter
- Content sections are conditionally included based on which plugins are present
- This keeps the approach simple (string building) without introducing a template engine
- Alternatives considered: Handlebars templates (overkill for this), external template files (adds filesystem dependency at build time)

**Decision: Tool landscape section at the top of the block**
- The managed block starts with a brief "this project uses these tools" overview before diving into wai-specific instructions
- This gives agents immediate context about the full toolchain
- The "When to Use What" table only appears when companion tools are detected (wai-only projects don't need a disambiguation table)

**Decision: Condensed wai instructions**
- The current wai block is ~90 lines. With plugin sections added, we need to be more concise
- Core wai instructions (phases, artifact types, handoffs) remain but are tightened
- Quick reference section becomes multi-tool when companions detected

## Risks / Trade-offs

- **Block size**: Adding plugin sections makes the block larger. Mitigated by condensing wai core instructions.
- **Stale detection**: If plugins are added/removed after `wai init`, the block becomes stale until `wai init` is re-run. Acceptable — `wai doctor` already flags this.
- **Content coupling**: Wai now "knows" about beads and openspec at the content level (describing their purpose). This is intentional for the orchestrator role but means updating wai when companion tool workflows change.

## Open Questions

None — the approach is straightforward string-building with conditional sections.
